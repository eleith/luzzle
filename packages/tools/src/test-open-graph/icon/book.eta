<% layout("@html") %>
<% const jpeg = await it.helpers.mediaToJpeg(it.piece.frontmatter.cover, 400, 550) %>
<% const pallete = await it.helpers.extractPaletteFromImage(jpeg) %>

<style>
	@font-face {
		font-family: 'Noto Sans', sans-serif;
		src: url(<%= it.helpers.fontToBase64('noto-sans.woff2') %>) format('woff2');
		font-weight: 100 900;
		font-style: normal;
		font-variation-settings: 'wdth' 100;
		font-optical-sizing: auto;
	}

	.container {
		z-index: 1;
		width: 100%;
		height: 100%;
		perspective: 3000px;
		font-family: 'Noto Sans', sans-serif;
		background: linear-gradient(135deg, <%= pallete.Vibrant?.hex %> 0%, <%= pallete.Muted?.hex %> 100%);
	}

	.container .book {
		position: relative;
		display: block;
		width: 400px;
		height: 550px;
		margin: 5% auto;
		border-radius: 2px 4px 4px 2px;
		background: linear-gradient(45deg, #DAD5DC 0%, #f2ebf4 100%);
		box-shadow: 13px 13px 8px 0px rgba(151, 146, 153, 0.6);
		font-weight: 400;
		color: #2b2b2b;
		transform-style: preserve-3d;
		transition: transform .5s;
	}

	.container .book {
		transform: rotate3d(0, 1, 0, 35deg);
	}

	.container .book>div,
	.container .front>div {
		display: block;
		position: absolute;
	}


	.container .front {
		transform-style: preserve-3d;
		transform-origin: 0% 50%;
		transition: transform .5s;
		transform: translate3d(0, 0, 20px);
		z-index: 10;
	}

	.container .front>div {
		width: 400px;
		height: 550px;
	}

	.container .left-side {
		width: 40px;
		left: -20px;
		height: 550px;
		background-color: rgba(232, 229, 234);
		transform: rotate3d(0, 1, 0, -90deg);
	}

	.cover svg {
		position: absolute;
		top: 50%;
		left: 45%;
		margin-top: -100px;
		margin-left: -110px;
		width: 300px;
	}

	.author {
		font-weight: 400;
		position: absolute;
		top: 475px;
		left: 50px;
		opacity: .8;
	}

	.container .front>div {
		border-radius: 0 3px 3px 0;
		box-shadow:
			inset 4px 0 10px rgba(0, 0, 0, 0.1);
	}

	.container .front:after {
		content: '';
		position: absolute;
		top: 1px;
		bottom: 1px;
		left: -1px;
		width: 1px;
	}

	.container .cover:after {
		content: '';
		position: absolute;
		top: 0;
		left: 10px;
		bottom: 0;
		width: 3px;
		background: rgba(0, 0, 0, 0.1);
		box-shadow: 1px 0 3px rgba(255, 255, 255, 0.1);
	}

	.container h2 {
		width: 500px;
		height: 40px;
		color: #2b2b2b;
		font-size: 15px;
		line-height: 40px;
		padding-right: 10px;
		text-align: center;
		transform-origin: 0 0;
		transform: rotate(90deg) translateY(-40px);
	}

	.cover {
		background: linear-gradient(45deg, #DAD5DC 0%, #f2ebf4 100%);
	}


	.left-side h2 span:first-child {
		font-weight: 400;
		font-size: 13px;
		padding-right: 20px;
	}

	.left-side h2 span:last-child {
	}

</style>

<div class="container">
	<div class="book">
		<div class="front">
			<div class="cover">
				<% if (it.piece.frontmatter.cover) { %>
					<img src="<%= it.helpers.imageToBase64(jpeg, 'jpeg') %>"
						style="width: 400px; height: 550px; object-fit: cover;" />
					<% } %>
			</div>
		</div>
		<div class="left-side">
			<h2>
				<span>
					<%= it.piece.frontmatter.author %>
				</span>
				<span>
					<%= it.piece.frontmatter.title %>
				</span>
			</h2>
		</div>
	</div>
</div>
